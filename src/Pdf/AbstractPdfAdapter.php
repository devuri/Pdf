<?php/* * This file is part of the UCSDMath package. * * (c) UCSD Mathematics | Math Computing Support <mathhelp@math.ucsd.edu> * * For the full copyright and license information, please view the LICENSE * file that was distributed with this source code. */namespace UCSDMath\Pdf;use mPDF;use UCSDMath\Functions\ServiceFunctions;use UCSDMath\Functions\ServiceFunctionsInterface;/** * AbstractPdfAdapter provides an abstract base class implementation of {@link PdfInterface}. * Primarily, this services the fundamental implementations for all Pdf classes. * * This component library is an adapter to the mPDF library. * * Method list: * * @see (+) __construct(); * @see (+) __destruct(); * @see (+) write(); * @see (+) setFontSize($size = null); * @see (+) setFontTypeface($fontType = null); * @see (+) setHeader(array $data = null); * @see (+) setFooter(array $data = null); * * @see (+) setMarginTop($marginTop = null); * @see (+) setMarginRight($marginRight = null); * @see (+) setMarginBottom($marginBottom = null); * @see (+) setMarginLeft($marginLeft = null); * @see (+) setMarginHeader($marginHeader = null); * @see (+) setMarginFooter($marginFooter = null); * @see (+) setMargins($marginTop,$marginRight,$marginBottom,$marginLeft,$marginHeader,$marginFooter); * * @see (+) setPaperSizeLetter(); * @see (+) setPaperSizeLegal(); * @see (+) setPaperSize($paperSize = null); * * @see (+) appendPageContent($str); * @see (+) appendPageCSS($str); * * @see (+) setPageAsPortrait(); * @see (+) setPageAsLandscape(); * * @see (+) setMetaTitle($str = null); * @see (+) setMetaAuthor($str = null); * @see (+) setMetaSubject($str = null); * @see (+) setMetaCreator($str = null); * @see (+) setMetaKeywords(array $words = null); * @see (-) registerPageMargins(); * @see (-) registerPageFormat($paperSize = null, $orientation = null); * * @author Daryl Eisner <deisner@ucsd.edu> */abstract class AbstractPdfAdapter implements PdfInterface, ServiceFunctionsInterface{    /**     * Constants.     */    const VERSION = '1.0.2';    /**     * Properties.     *     * @var    mPDF         $mpdf               A mPDF Interface instance     * @var    string       $characterEncoding  A default character encoding     * @var    int          $fontSize           A default font size specified in points (pt.)     * @var    string       $fontTypeface       A default font typeface     * @var    array        $pageHeader         A page header content to render     * @var    array        $pageFooter         A page footer content to render     * @var    string       $pageCSS            A page style setting     * @var    string       $pageContent        A page content to render     * @var    string       $paperSize          A page size ['Letter','Legal','A4','Tabloid', etc.]     * @var    string       $pageFormat         A page size and orientation scheme ['Letter','Legal-L'] (based in mm)     * @var    string       $pageOrientation    A setup orientation ['Portrait','Landscape']     * @var    int          $marginTop          A top margin size specified as length in millimetres (mm)     * @var    int          $marginRight        A right margin size specified as length in millimetres (mm)     * @var    int          $marginBottom       A bottom margin size specified as length in millimetres (mm)     * @var    int          $marginLeft         A left margin size specified as length in millimetres (mm)     * @var    int          $marginHeader       A header margin size specified as length in millimetres (mm)     * @var    int          $marginFooter       A footer margin size specified as length in millimetres (mm)     * @var    string       $metaTitle          A document title (e.g., metadata)     * @var    string       $metaAuthor         A document author (e.g., metadata)     * @var    string       $metaSubject        A document subject (e.g., metadata)     * @var    string       $metaCreator        A document creator (e.g., metadata)     * @var    array        $metaKeywords       A document list of descriptive keywords (e.g., metadata)     * @var    array        $storageRegister    A set of validation stored data elements     * @static PdfInterface $instance           A PdfInterface instance     * @static integer      $objectCount        A PdfInterface instance count     */    protected $mpdf               = null;    protected $characterEncoding  = 'utf-8';    protected $fontSize           = 12;    protected $fontTypeface       = 'Times';    protected $pageHeader         = [];    protected $pageFooter         = [];    protected $pageCSS            = null;    protected $pageContent        = null;    protected $paperSize          = 'Letter';    protected $pageFormat         = 'Letter';    protected $pageOrientation    = 'Portrait';    protected $marginTop          = 8;    protected $marginRight        = 8;    protected $marginBottom       = 8;    protected $marginLeft         = 8;    protected $marginHeader       = 10;    protected $marginFooter       = 10;    protected $metaTitle          = null;    protected $metaAuthor         = null;    protected $metaSubject        = null;    protected $metaCreator        = null;    protected $metaKeywords       = [];    protected $storageRegister    = [];    protected static $instance    = null;    protected static $objectCount = 0;    /**     * Constructor.     *     * @param \mPDF  $mpdf  A mPDF Interface instance     *     * @api     */    public function __construct(mPDF $mpdf)    {        $this->mpdf = $mpdf;        $this->registerPageFormat();        static::$instance = $this;        static::$objectCount++;    }    /**     * Destructor.     */    public function __destruct()    {        static::$objectCount--;    }    /**     * Write PDF to screen.     *     * @return PdfInterface     *     * @api     */    public function write()    {        /** Setup */        $this->setFontSize()            ->setFontTypeface()                ->registerPageFormat()                    ->registerPageMargins()                        ->setPageAsPortrait();        $footer = [            'odd' => [                'L' => [                    'content'     => 'Today: {DATE m/d/Y h:i A}',                    'font-size'   => 9,                    'font-style'  => '',                    'font-family' => 'Arial',                    'color'       => '#000000'                ],                'C' => [                    'content'     => 'Transfer Equivalencies',                    'font-size'   => 9,                    'font-style'  => 'I',                    'font-family' => 'Arial',                    'color'       => '#000000'                ],                'R' => [                    'content'     => 'Page {PAGENO} of {nb}',                    'font-size'   => 9,                    'font-style'  => '',                    'font-family' => 'Arial',                    'color'       => '#000000'                ],                'line' => false,            ],            'even' => []        ];        $footer2 = [            'page'    => 'odd',    /** ['odd','even','both']     */            'align'   => 'center', /** ['left','right','center'] */            'content' => '',            'A' => 'A'        ];        $this->appendPageContent('Testing...');        $this->mpdf->setFooter($footer);        /** Render any document metadata */        $this            ->setMetaTitle('Abstract')                ->setMetaAuthor('Daryl Eisner')                    ->setMetaCreator('Wilson')                        ->setMetaSubject('Coding')                            ->setMetaKeywords(array('fun','cool'));        /** finally render document */        $this->mpdf->Output();        return;    }    /**     * Set page header.     *     * @param array $data  A list of header items     *     * @return PdfInterface     *     * @api     */    public function setHeader(array $data = null)    {        $this->setProperty('pageHeader', $data);        $this->mpdf->setHeader($this->pageHeader);        return $this;    }    /**     * Set page footer.     *     * @param array $data  A list of footer items     *     * @return PdfInterface     *     * @api     */    public function setFooter(array $data = null)    {        $this->setProperty('pageFooter', $data);        $this->mpdf->setFooter($this->pageFooter);        return $this;    }    /**     * ===================== | Organized Section | ===================     */    /**     * {@inheritdoc}     */    public function setFontSize($size = null)    {        isset($size) && is_int($size)            ? $this->fontSize = $size            : null;        $this->mpdf->SetDefaultFontSize($this->fontSize);        return $this;    }    /**     * {@inheritdoc}     */    public function setFontTypeface($fontType = null)    {        isset($fontType) && isString($fontType)            ? $this->fontTypeface = $fontType            : null;        $this->mpdf->SetDefaultFont($this->fontTypeface);        return $this;    }    /**     * {@inheritdoc}     */    public function setMetaCreator($str = null)    {        isset($str) && $this->isString($str)            ? $this->setProperty('metaCreator', $str)            : $this->setProperty('metaCreator', null);        $this->mpdf->SetCreator($this->metaCreator);        return $this;    }    /**     * {@inheritdoc}     */    public function setMetaSubject($str = null)    {        isset($str) && $this->isString($str)            ? $this->setProperty('metaSubject', $str)            : $this->setProperty('metaSubject', null);        $this->mpdf->SetSubject($this->metaSubject);        return $this;    }    /**     * {@inheritdoc}     */    public function setMetaTitle($str = null)    {        isset($str) && $this->isString($str)            ? $this->setProperty('metaTitle', $str)            : $this->setProperty('metaTitle', null);        $this->mpdf->SetTitle($this->metaTitle);        return $this;    }    /**     * {@inheritdoc}     */    public function setMetaAuthor($str = null)    {        isset($str) && $this->isString($str)            ? $this->setProperty('metaAuthor', $str)            : $this->setProperty('metaAuthor', null);        $this->mpdf->SetAuthor($this->metaAuthor);        return $this;    }    /**     * {@inheritdoc}     */    public function setMetaKeywords(array $words = null)    {        isset($words) && ((array) $words === $words)            ? $this->setProperty('metaKeywords', array_merge($this->metaKeywords, $words))            : null;        $this->mpdf->SetKeywords(implode(', ', $this->metaKeywords));        return $this;    }    /**     * {@inheritdoc}     */    public function setMarginTop($marginTop = null)    {        isset($marginTop) && is_int($marginTop)            ? $this->setProperty('marginTop', $marginTop)            : null;        return $this;    }    /**     * {@inheritdoc}     */    public function setMarginRight($marginRight = null)    {        isset($marginRight) && is_int($marginRight)            ? $this->setProperty('marginRight', $marginRight)            : null;        return $this;    }    /**     * {@inheritdoc}     */    public function setMarginBottom($marginBottom = null)    {        isset($marginBottom) && is_int($marginBottom)            ? $this->setProperty('marginBottom', $marginBottom)            : null;        return $this;    }    /**     * {@inheritdoc}     */    public function setMarginLeft($marginLeft = null)    {        isset($marginLeft) && is_int($marginLeft)            ? $this->setProperty('marginLeft', $marginLeft)            : null;        return $this;    }    /**     * {@inheritdoc}     */    public function setMarginHeader($marginHeader = null)    {        isset($marginHeader) && is_int($marginHeader)            ? $this->setProperty('marginHeader', $marginHeader)            : null;        return $this;    }    /**     * {@inheritdoc}     */    public function setMarginFooter($marginFooter = null)    {        isset($marginFooter) && is_int($marginFooter)            ? $this->setProperty('marginFooter', $marginFooter)            : null;        return $this;    }    /**     * {@inheritdoc}     */    public function setMargins(        $marginTop    = null,        $marginRight  = null,        $marginBottom = null,        $marginLeft   = null,        $marginHeader = null,        $marginFooter = null    ) {        isset($marginTop) && is_int($marginTop)            ? $this->setProperty('marginTop', $marginTop)            : null;        isset($marginRight) && is_int($marginRight)            ? $this->setProperty('marginRight', $marginRight)            : null;        isset($marginBottom) && is_int($marginBottom)            ? $this->setProperty('marginBottom', $marginBottom)            : null;        isset($marginLeft) && is_int($marginLeft)            ? $this->setProperty('marginLeft', $marginLeft)            : null;        isset($marginHeader) && is_int($marginHeader)            ? $this->setProperty('marginHeader', $marginHeader)            : null;        isset($marginFooter) && is_int($marginFooter)            ? $this->setProperty('marginFooter', $marginFooter)            : null;        return $this;    }    /**     * {@inheritdoc}     */    public function setPaperSizeLetter()    {        $this->setProperty('paperSize', 'Letter');        return $this;    }    /**     * {@inheritdoc}     */    public function setPaperSizeLegal()    {        $this->setProperty('paperSize', 'Legal');        return $this;    }    /**     * {@inheritdoc}     */    public function setPaperSize($paperSize = null)    {        if ($this->isString($paperSize)) {            switch ($paperSize) {                case 'Letter':                    $this->setProperty('paperSize', $paperSize);                    break;                case 'Legal':                    $this->setProperty('paperSize', $paperSize);                    break;                case 'A4':                    $this->setProperty('paperSize', $paperSize);                    break;                case 'Tabloid':                    $this->setProperty('paperSize', $paperSize);                    break;                default:                    $this->setProperty('paperSize', static::DEFAULT_PAGE_SIZE);            }        }        $this->registerPageFormat();        return $this;    }    /**     * {@inheritdoc}     */    public function appendPageContent($str)    {        $this->setProperty('pageContent', $str);        $this->mpdf->WriteHTML($this->pageContent);        return $this;    }    /**     * {@inheritdoc}     */    public function appendPageCSS($str)    {        $this->setProperty('pageCSS', $str);        $this->mpdf->WriteCSS($this->pageCSS, 1);        return $this;    }    /**     * {@inheritdoc}     */    public function setPageAsLandscape()    {        $this->setProperty('pageOrientation', 'Landscape');        $this->registerPageFormat();        return $this;    }    /**     * {@inheritdoc}     */    public function setPageAsPortrait()    {        $this->setProperty('pageOrientation', 'Portrait');        $this->registerPageFormat();        return $this;    }    /**     * Generate and store a defined PDF page format.     *     * @param string $paperSize    A page format type ['Letter','Legal', etc.]     * @param string $orientation  A page orientation ['Portrait','Landscape']     *     * @return PdfInterface     */    protected function registerPageFormat($paperSize = null, $orientation = null)    {        if ($this->isString($paperSize)) {            switch ($paperSize) {                case 'Letter':                    $this->setProperty('paperSize', $paperSize);                    break;                case 'Legal':                    $this->setProperty('paperSize', $paperSize);                    break;                case 'A4':                    $this->setProperty('paperSize', $paperSize);                    break;                case 'Tabloid':                    $this->setProperty('paperSize', $paperSize);                    break;                default:                    $this->setProperty('paperSize', static::DEFAULT_PAGE_SIZE);            }        }        if (null !== $orientation && $this->isString($orientation)) {            $this->setProperty('pageOrientation',                $orientation === 'Landscape'                    ? 'Landscape'                    : 'Portrait'            );        }        $orientation = $this->pageOrientation[0];        $this->setProperty('pageFormat',            $this->pageOrientation[0] === 'L'                ? $this->pageFormat.'-'.$this->pageOrientation[0]                : $this->pageFormat        );        $this->mpdf->_setPageSize($this->pageFormat, $orientation);        return $this;    }    /**     * Registering the page size and margins.     *     * @return PdfInterface     *     * @api     */    protected function registerPageMargins()    {        $mpdf = $this->mpdf;        $mpdf->_setPageSize($this->pageFormat, $this->pageOrientation);        /** Set the margins and page current page width */        $mpdf->SetLeftMargin($this->marginLeft);            /** Sets the Left page margin for the new document   */        $mpdf->SetTopMargin($this->marginTop);              /** Sets the Top page margin for the new document    */        $mpdf->SetRightMargin($this->marginRight);          /** Sets the Right page margin for the new document  */        $mpdf->SetAutoPageBreak(true, $this->marginBottom); /** Sets the Bottom page margin for the new document */        $mpdf->margin_header = $this->marginHeader;         /** Sets the Header page margin for the new document */        $mpdf->margin_footer = $this->marginFooter;         /** Sets the Footer page margin for the new document */        $mpdf->orig_lMargin = $mpdf->DeflMargin = $mpdf->lMargin = $this->marginLeft;        $mpdf->orig_tMargin = $mpdf->tMargin = $this->marginTop;        $mpdf->orig_rMargin = $mpdf->DefrMargin = $mpdf->rMargin = $this->marginRight;        $mpdf->orig_bMargin = $mpdf->bMargin = $this->marginBottom;        $mpdf->orig_hMargin = $mpdf->margin_header = $this->marginHeader;        $mpdf->orig_fMargin = $mpdf->margin_footer = $this->marginFooter;        $mpdf->pgwidth = $mpdf->w - $mpdf->lMargin - $mpdf->rMargin;        return $this;    }    /**     * Method implementations inserted.     *     * The notation below illustrates visibility: (+) @api, (-) protected or private.     *     * @see (+) all();     * @see (+) init();     * @see (+) get($key);     * @see (+) has($key);     * @see (+) getClassName();     * @see (+) getConst($key);     * @see (+) set($key, $value);     * @see (+) isString($string);     * @see (+) getInstanceCount();     * @see (+) getClassInterfaces();     * @see (+) getProperty($name, $key = null);     * @see (-) doesFunctionExist($functionName);     * @see (+) isStringKey($string, array $keys);     * @see (-) throwExceptionError(array $error);     * @see (+) setProperty($name, $value, $key = null);     * @see (-) throwInvalidArgumentExceptionError(array $error);     */    use ServiceFunctions;}